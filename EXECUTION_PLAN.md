# 🎯 Anki卡片生成器 - 项目执行计划

## 📋 项目概述

**目标**: 基于现有V1版本，进行轻量化重构，优化项目结构和代码质量
**原则**: 保持功能完整，简化技术栈，提升可维护性
**周期**: 7-10天

## 🛠️ 最终技术选型（轻量化）

### 前端技术栈
- **框架**: React 18.2 (保持现有)
- **构建工具**: Create React App (保持现有)
- **语言**: TypeScript 4.9 (保持现有)
- **样式**: Tailwind CSS 3.x (保持现有)
- **状态管理**: React Hooks + Context (保持现有)
- **HTTP客户端**: Axios 1.x (保持现有)
- **图标**: Lucide React (保持现有)
- **测试**: Jest + React Testing Library (保持现有)

### 后端技术栈
- **运行时**: Node.js 18 LTS (保持现有)
- **框架**: Express.js 4.x (保持现有)
- **语言**: TypeScript 4.9 (保持现有)
- **数据库**: SQLite3 (保持现有)
- **文件处理**: Multer + Sharp (保持现有)
- **打包**: JSZip (保持现有)
- **测试**: Jest + Supertest (保持现有)

## 📅 详细执行计划

### Phase 1: 项目结构整理 (1-2天)

#### 1.1 清理项目结构
- [ ] **删除冗余项目**: 删除 `anki-card-generator-v2` 目录
- [ ] **统一根目录**: 以 `anki-card-generator` 作为唯一项目
- [ ] **整理文档**: 合并README和配置文件

#### 1.2 优化目录结构
```
anki-card-generator/
├── 📄 README.md                 # 项目总览和使用指南
├── 📄 package.json             # 根项目脚本配置
├── 📄 .env.example            # 环境变量模板
├── 📄 .gitignore
├── 📄 start.sh                # 一键启动脚本
│
├── 📁 backend/                # 后端服务
│   ├── 📄 package.json
│   ├── 📄 tsconfig.json
│   ├── 📄 jest.config.js
│   └── 📁 src/
│       ├── 📄 index.ts
│       ├── 📁 routes/        # API路由
│       ├── 📁 services/      # 业务逻辑
│       ├── 📁 middleware/    # 中间件
│       ├── 📁 types/         # 类型定义
│       └── 📁 tests/         # 测试文件
│
└── 📁 frontend/               # 前端应用
    ├── 📄 package.json
    ├── 📄 tsconfig.json
    ├── 📄 tailwind.config.js
    ├── 📁 public/
    └── 📁 src/
        ├── 📄 App.tsx
        ├── 📄 index.tsx
        ├── 📁 components/    # React组件
        ├── 📁 services/      # API服务
        ├── 📁 types/         # 类型定义
        └── 📁 __tests__/     # 测试文件
```

#### 1.3 更新根package.json
- [ ] **添加启动脚本**: 统一管理前后端启动
- [ ] **添加开发脚本**: 并行启动前后端开发环境
- [ ] **添加构建脚本**: 统一构建流程
- [ ] **添加测试脚本**: 运行所有测试

### Phase 2: 代码优化 (3-4天)

#### 2.1 前端代码优化

**组件重构**:
- [ ] **CardForm组件**: 简化状态管理，优化表单处理
- [ ] **CardList组件**: 优化渲染性能，添加虚拟滚动（如果需要）
- [ ] **ErrorBoundary**: 添加全局错误边界组件
- [ ] **Loading组件**: 统一加载状态展示

**状态管理优化**:
- [ ] **简化Context**: 只保留必要的全局状态
- [ ] **本地状态**: 优先使用组件本地状态
- [ ] **状态持久化**: 添加localStorage支持用户设置

**API服务优化**:
- [ ] **统一错误处理**: 简化错误处理逻辑
- [ ] **请求重试**: 优化重试机制
- [ ] **缓存策略**: 添加简单的响应缓存
- [ ] **类型安全**: 完善TypeScript类型定义

#### 2.2 后端代码优化

**服务层重构**:
- [ ] **LLMService**: 简化多提供商调用逻辑
- [ ] **AnkiService**: 优化数据库操作和文件生成
- [ ] **FileService**: 统一文件处理逻辑

**中间件优化**:
- [ ] **合并验证中间件**: 创建通用验证器
- [ ] **错误处理中间件**: 统一错误响应格式
- [ ] **日志中间件**: 优化日志输出格式
- [ ] **限流中间件**: 添加API调用限制

**路由优化**:
- [ ] **统一响应格式**: 所有API返回统一格式
- [ ] **参数验证**: 使用Joi或类似库简化验证
- [ ] **文档注释**: 添加JSDoc注释

### Phase 3: 配置和部署优化 (1-2天)

#### 3.1 环境配置
- [ ] **统一环境变量**: 创建配置管理模块
- [ ] **配置验证**: 启动时验证必要配置
- [ ] **默认配置**: 提供合理的默认值
- [ ] **开发/生产分离**: 不同环境的配置管理

#### 3.2 构建和部署
- [ ] **Docker配置**: 创建轻量级Dockerfile（可选）
- [ ] **启动脚本**: 优化start.sh脚本
- [ ] **健康检查**: 添加应用健康检查
- [ ] **日志配置**: 优化日志输出和轮转

#### 3.3 性能优化
- [ ] **前端构建**: 优化webpack配置
- [ ] **图片处理**: 优化Sharp配置
- [ ] **内存管理**: 监控和优化内存使用
- [ ] **并发控制**: 优化批量处理的并发数

### Phase 4: 测试和文档 (1-2天)

#### 4.1 测试完善
- [ ] **单元测试**: 确保核心逻辑测试覆盖率 > 80%
- [ ] **集成测试**: 添加API端点集成测试
- [ ] **E2E测试**: 添加关键流程端到端测试
- [ ] **性能测试**: 验证批量处理性能

#### 4.2 文档更新
- [ ] **README更新**: 包含安装、配置、使用说明
- [ ] **API文档**: 更新API接口文档
- [ ] **开发指南**: 添加开发者文档
- [ ] **部署指南**: 添加部署说明

## 🎯 具体任务清单

### 必须完成的核心任务

#### 高优先级 (P0)
- [ ] **项目结构清理**: 删除anki-card-generator-v2，整理目录结构
- [ ] **核心功能验证**: 确保所有现有功能正常工作
- [ ] **类型安全**: 修复所有TypeScript类型错误
- [ ] **错误处理**: 添加全局错误处理和用户友好的错误提示
- [ ] **基础测试**: 确保所有API端点有基础测试覆盖

#### 中优先级 (P1)
- [ ] **代码优化**: 简化复杂的组件和服务逻辑
- [ ] **性能优化**: 优化图片处理和批量操作性能
- [ ] **用户体验**: 改进加载状态和交互反馈
- [ ] **配置管理**: 统一环境变量和配置管理
- [ ] **文档完善**: 更新README和API文档

#### 低优先级 (P2)
- [ ] **Docker化**: 创建Docker配置文件
- [ ] **监控日志**: 添加应用监控和日志管理
- [ ] **缓存策略**: 添加响应缓存机制
- [ ] **国际化**: 添加多语言支持（如果需要）

### 技术债务清理

#### 代码质量
- [ ] **删除未使用代码**: 清理import和未使用的函数
- [ ] **统一命名规范**: 确保变量、函数、文件命名一致
- [ ] **代码格式化**: 使用Prettier统一代码格式
- [ ] **ESLint规则**: 修复所有ESLint警告

#### 依赖管理
- [ ] **依赖版本检查**: 确保所有依赖是稳定版本
- [ ] **安全漏洞检查**: 运行npm audit修复安全问题
- [ ] **未使用依赖**: 删除未使用的npm包
- [ ] **包大小优化**: 分析和优化bundle大小

## 📊 验收标准

### 功能验收
- ✅ 所有现有功能正常工作
- ✅ AI卡片生成功能正常
- ✅ 质量检查系统正常
- ✅ Anki文件导出正常
- ✅ 图片上传和处理正常
- ✅ 批量操作功能正常

### 性能验收
- ✅ 单卡片生成时间 < 30秒
- ✅ 批量20张卡片 < 2分钟
- ✅ 图片上传 < 10秒（10MB）
- ✅ 内存使用 < 512MB
- ✅ 前端首屏加载 < 3秒

### 质量验收
- ✅ 无TypeScript类型错误
- ✅ 测试覆盖率 > 80%
- ✅ 无安全漏洞
- ✅ 代码格式一致
- ✅ 文档完整清晰

## 🚨 风险控制

### 技术风险
- **风险**: 重构可能破坏现有功能
- **缓解**: 逐步重构，每步都进行功能验证

### 进度风险
- **风险**: 重构时间超出预期
- **缓解**: 优先完成核心功能，非关键功能可后续优化

### 质量风险
- **风险**: 新代码引入bug
- **缓解**: 充分测试，代码审查

## 📝 执行注意事项

1. **保持功能完整性**: 不删除任何现有功能
2. **渐进式重构**: 每次只改一小部分，立即测试
3. **向后兼容**: API接口保持兼容
4. **用户体验**: 确保用户界面体验不下降
5. **文档同步**: 代码变更同步更新文档

---

## 🎉 成功标准

重构完成后，项目将具备：
- **更清晰的项目结构**: 易于理解和维护
- **更稳定的代码质量**: 减少bug和技术债务
- **更好的用户体验**: 更快的响应和更好的错误处理
- **更完善的文档**: 便于后续开发和维护
- **更轻松的部署**: 简化的配置和部署流程